# SPRINT PLAN - NUEVAS FUNCIONALIDADES
## Intercultural Experience Platform

**Fecha de Inicio:** 16 de Octubre, 2025  
**Duraci√≥n:** 8 semanas (4 sprints de 2 semanas)  
**Equipo:** 10 roles seg√∫n TEAM_STRUCTURE.md  
**Metodolog√≠a:** Scrum adaptado

---

## üéØ RESUMEN EJECUTIVO

Este plan aborda **9 √©picas principales** organizadas en 4 sprints de 2 semanas, siguiendo la metodolog√≠a Scrum adaptada del equipo.

### √âpicas Priorizadas:

**Sprint 1-2 (Semanas 1-4):** Roles y Notificaciones
- ‚úÖ √âpica 1: Sistema de Roles de Agentes
- ‚úÖ √âpica 2: Alertas por Email y Mensajer√≠a Masiva

**Sprint 3 (Semanas 5-6):** Importaci√≥n y Auditor√≠a
- üì¶ √âpica 3: Carga Masiva de Datos
- üì¶ √âpica 4: Registro de Actividad

**Sprint 4 (Semanas 7-8):** Deadlines y Facturaci√≥n
- üì¶ √âpica 5: Sistema de Deadlines y Recordatorios
- üì¶ √âpica 6: Recibos y Cuotas de Pago
- üì¶ √âpica 7: Estado de Participantes
- üì¶ √âpica 8: Papelera de Reciclaje
- üì¶ √âpica 9: Declaraci√≥n de Mayor√≠a de Edad

---

## üìã √âPICA 1: SISTEMA DE ROLES Y GESTI√ìN DE AGENTES

### User Story 1.1: Crear Rol de Agentes

**Como** administrador del sistema  
**Quiero** tener un nuevo rol de "Agente"  
**Para que** puedan crear participantes y asignarlos a programas sin tener acceso completo de administrador

### Acceptance Criteria:
- [x] Existe un rol `agent` en la tabla users (adem√°s de `admin` y `user`)
- [x] Los agentes pueden acceder a un panel espec√≠fico `/agent/*`
- [x] Los agentes pueden crear nuevos participantes (usuarios con rol `user`)
- [x] Los agentes pueden asignar participantes a programas
- [x] Los agentes NO pueden acceder a funciones administrativas
- [x] Los agentes pueden ver solo los participantes que ellos crearon
- [x] Existe un CRUD de agentes en el panel administrativo

### Tareas Backend Developer:
- [x] Crear migraci√≥n para agregar rol `agent` al enum de `users.role`
- [x] Crear `AgentMiddleware` para proteger rutas de agentes
- [x] Crear `AgentController` con m√©todos: dashboard, createParticipant, assignToProgram, myParticipants
- [x] Agregar campo `created_by_agent_id` a tabla users (nullable, foreign key)
- [x] Crear pol√≠ticas (Policies) para verificar que agente solo ve sus participantes
- [x] Crear rutas en `routes/web.php` para `/agent/*`
- [x] Crear seeder para usuario agente de prueba

### Tareas Frontend Developer:
- [x] Crear layout `resources/views/layouts/agent.blade.php`
- [x] Crear vistas: `agent/dashboard.blade.php`, `agent/participants/index.blade.php`, `agent/participants/create.blade.php`
- [x] Implementar formulario de creaci√≥n de participantes para agentes
- [x] Implementar selector de programas para asignaci√≥n
- [x] Agregar indicador visual de "Creado por: [Nombre Agente]" en vista de participantes del admin

### Tareas UI Designer:
- [x] Dise√±ar interfaz del panel de agentes (diferente a admin)
- [x] Dise√±ar dashboard de agentes con m√©tricas
- [x] Dise√±ar flujo de creaci√≥n de participante simplificado

### Tareas QA Engineer:
- [x] Crear test cases para permisos de agentes
- [x] Verificar que agentes NO pueden acceder a rutas admin
- [x] Verificar que agentes solo ven sus propios participantes
- [x] Crear tests de integraci√≥n

### Tareas Security Specialist:
- [x] Auditar que agentes no pueden escalar privilegios
- [x] Verificar que pol√≠ticas de autorizaci√≥n est√°n correctamente implementadas
- [x] Revisar que no hay SQL injection en filtros por agente

---

## üìã √âPICA 2: SISTEMA DE NOTIFICACIONES Y ALERTAS

### User Story 2.1: Alertas por Email

**Como** sistema  
**Quiero** enviar emails autom√°ticos en eventos clave  
**Para** mantener informados a usuarios, agentes y administradores

### Acceptance Criteria:
- [x] Se env√≠a email cuando se crea un nuevo usuario (admin, agente o participante)
- [x] El email incluye credenciales temporales (contrase√±a generada)
- [x] Se env√≠a email de bienvenida personalizado seg√∫n rol
- [x] Se env√≠a email cuando un participante es asignado a un programa
- [x] Se env√≠a email cuando cambia el estado de una aplicaci√≥n
- [x] Se env√≠a email cuando se verifica un pago
- [x] Todos los emails tienen dise√±o responsive y branding de IE

### Tareas Backend Developer:
- [x] Crear Mailable classes: WelcomeUser, CredentialsSent, ProgramAssigned, ApplicationStatusChanged, PaymentVerified
- [x] Crear Notification classes usando Laravel Notifications
- [x] Implementar eventos: UserCreated, ParticipantAssignedToProgram, ApplicationStatusChanged, PaymentVerified
- [x] Crear listeners para cada evento que env√≠en emails
- [x] Configurar queue para env√≠o as√≠ncrono de emails
- [x] Crear comando `php artisan emails:test` para probar env√≠os
- [x] Agregar configuraci√≥n en .env para habilitar/deshabilitar emails

### User Story 2.2: Mensajer√≠a Masiva

**Como** administrador  
**Quiero** enviar notificaciones masivas a usuarios  
**Para** comunicar informaci√≥n importante de forma eficiente

### Acceptance Criteria:
- [x] Existe m√≥dulo "Mensajer√≠a Masiva" en panel admin
- [x] Puedo seleccionar destinatarios: todos, por rol, por programa, por estado
- [x] Puedo enviar por: Email, Push Notification (app m√≥vil), o ambos
- [x] Puedo programar env√≠o para fecha/hora espec√≠fica
- [x] Puedo ver historial de mensajes enviados
- [x] Puedo ver estad√≠sticas: enviados, entregados, le√≠dos, fallidos
- [x] Los usuarios pueden ver notificaciones en la app

### Tareas Backend Developer:
- [x] Crear modelo MassMessage con campos requeridos
- [x] Crear migraci√≥n para tabla mass_messages
- [x] Crear tabla mass_message_recipients (pivot) para tracking
- [x] Crear MassMessageController con CRUD
- [x] Implementar job SendMassMessageJob para procesamiento as√≠ncrono
- [x] Integrar con Firebase Cloud Messaging para push notifications
- [x] Crear API endpoint para app m√≥vil: GET /api/notifications
- [x] Implementar filtros: por rol, por programa, por estado

---

## üìã √âPICA 3: CARGA MASIVA DE DATOS

### User Story 3.1: Importaci√≥n Masiva de Usuarios

**Como** administrador  
**Quiero** importar usuarios masivamente desde Excel/CSV  
**Para** agilizar la carga inicial de datos

### Acceptance Criteria:
- [ ] Existe m√≥dulo "Importaci√≥n Masiva" en panel admin
- [ ] Puedo descargar plantillas de ejemplo
- [ ] Puedo subir archivo Excel (.xlsx) o CSV
- [ ] El sistema valida datos antes de importar
- [ ] Se muestra preview de datos con errores resaltados
- [ ] Se genera reporte de importaci√≥n
- [ ] Se env√≠an emails a usuarios importados

---

## üìã √âPICA 4: SISTEMA DE AUDITOR√çA

### User Story 4.1: Registro de Actividad de Usuarios

**Como** administrador  
**Quiero** ver un registro de todas las acciones de usuarios  
**Para** auditar el sistema y detectar problemas

### Acceptance Criteria:
- [ ] Se registran todas las acciones importantes
- [ ] Cada registro incluye: usuario, acci√≥n, modelo, fecha/hora, IP
- [ ] Existe vista de "Registro de Actividad" en panel admin
- [ ] Puedo filtrar por: usuario, acci√≥n, fecha, modelo
- [ ] El registro es inmutable

---

## üìã √âPICA 5: SISTEMA DE DEADLINES

### User Story 5.1: Deadlines para Requisitos

**Como** administrador  
**Quiero** establecer fechas l√≠mite para requisitos  
**Para que** participantes sepan cu√°ndo deben completarlos

### Acceptance Criteria:
- [ ] Puedo establecer deadline al crear/editar un requisito
- [ ] El deadline se muestra en la app del participante
- [ ] Se env√≠an recordatorios autom√°ticos: 30, 15, 7, 3, 1 d√≠as antes
- [ ] Despu√©s del deadline, el requisito se marca como "Vencido"

---

## üìã √âPICA 6: SISTEMA DE FACTURACI√ìN

### User Story 6.1: Generaci√≥n de Recibos de Pago

**Como** participante  
**Quiero** descargar recibos de mis pagos  
**Para** tener comprobante de pago

### User Story 6.2: Sistema de Cuotas de Pago

**Como** administrador  
**Quiero** crear planes de cuotas para participantes  
**Para** facilitar el pago de programas

---

## üìã √âPICA 7: GESTI√ìN DE ESTADO DE PARTICIPANTES

### User Story 7.1: Estado de Participante en Programas

**Como** administrador  
**Quiero** ver y gestionar el estado de participantes  
**Para** saber qui√©nes est√°n activos, culminaron o son ex-participantes

---

## üìã √âPICA 8: PAPELERA DE RECICLAJE

### User Story 8.1: Soft Delete con Papelera

**Como** administrador  
**Quiero** que los registros eliminados vayan a una papelera  
**Para** poder recuperarlos si fue un error

---

## üìã √âPICA 9: DECLARACI√ìN DE MAYOR√çA DE EDAD

### User Story 9.1: Checkbox de Mayor de Edad

**Como** sistema  
**Quiero** que usuarios confirmen ser mayores de edad  
**Para** cumplir con requisitos legales

---

## üîÑ FLUJO DE TRABAJO Y CHECKPOINTS

### Checkpoint 1: Dise√±o (D√≠a 2)
- **UI Designer** ‚Üí Entrega mockups
- **Revisores:** UX Researcher, Frontend Dev, End User
- **Criterio:** Aprobaci√≥n de 3/3 revisores

### Checkpoint 2: Backend (D√≠a 7)
- **Backend Developer** ‚Üí Crea PR
- **Revisores:** Code Reviewer, Security Specialist
- **Criterio:** 0 vulnerabilidades cr√≠ticas, tests >70%

### Checkpoint 3: Frontend (D√≠a 10)
- **Frontend Developer** ‚Üí Crea PR
- **Revisores:** UI Designer, Code Reviewer
- **Criterio:** Fidelidad al dise√±o >95%

### Checkpoint 4: Integraci√≥n (D√≠a 12)
- **DevOps Engineer** ‚Üí Deploy a staging
- **QA Engineer** ‚Üí Ejecuta test plan completo
- **Criterio:** 0 bugs bloqueantes

### Checkpoint 5: UAT (D√≠a 14)
- **End User** ‚Üí Valida funcionalidad
- **Project Manager** ‚Üí Aprueba para producci√≥n
- **Criterio:** Cumple 100% acceptance criteria

---

## üìä DEFINITION OF DONE

Cada user story debe cumplir:

### C√≥digo:
- [ ] Implementado seg√∫n acceptance criteria
- [ ] Sigue est√°ndares PSR-12 (PHP) / ESLint (JS)
- [ ] Sin warnings en logs

### Testing:
- [ ] Tests unitarios >70% cobertura
- [ ] Tests E2E para flujos cr√≠ticos
- [ ] QA manual completado

### Seguridad:
- [ ] Security review aprobado
- [ ] Sin vulnerabilidades cr√≠ticas/altas
- [ ] Validaci√≥n de inputs implementada

### Documentaci√≥n:
- [ ] C√≥digo comentado (PHPDoc/JSDoc)
- [ ] README actualizado
- [ ] API documentada (si aplica)

### Deployment:
- [ ] Desplegado en staging
- [ ] Smoke tests pasados
- [ ] Migraciones ejecutadas

### Aprobaci√≥n:
- [ ] Code review aprobado
- [ ] UAT aprobado por End User
- [ ] Sign-off de Project Manager

---

## üìà MATRIZ DE RESPONSABILIDADES

| √âpica | Backend | Frontend Web | Frontend Mobile | UI Designer | QA | Security | DevOps |
|-------|---------|--------------|-----------------|-------------|----|---------|----|
| Roles Agentes | ‚úÖ Lead | ‚úÖ Support | ‚ùå | ‚úÖ Support | ‚úÖ | ‚úÖ | ‚ùå |
| Notificaciones | ‚úÖ Lead | ‚úÖ Support | ‚úÖ Support | ‚úÖ Support | ‚úÖ | ‚úÖ | ‚úÖ Lead |
| Carga Masiva | ‚úÖ Lead | ‚úÖ Support | ‚ùå | ‚úÖ Support | ‚úÖ | ‚ùå | ‚ùå |
| Auditor√≠a | ‚úÖ Lead | ‚úÖ Support | ‚ùå | ‚úÖ Support | ‚úÖ | ‚úÖ | ‚ùå |
| Deadlines | ‚úÖ Lead | ‚úÖ Support | ‚úÖ Support | ‚úÖ Support | ‚úÖ | ‚ùå | ‚úÖ Support |
| Facturaci√≥n | ‚úÖ Lead | ‚úÖ Support | ‚úÖ Support | ‚úÖ Lead | ‚úÖ | ‚úÖ | ‚ùå |
| Estado Participantes | ‚úÖ Lead | ‚úÖ Support | ‚úÖ Support | ‚úÖ Support | ‚úÖ | ‚ùå | ‚ùå |
| Papelera | ‚úÖ Lead | ‚úÖ Support | ‚ùå | ‚úÖ Support | ‚úÖ | ‚úÖ | ‚ùå |
| Mayor de Edad | ‚úÖ Support | ‚úÖ Support | ‚úÖ Lead | ‚úÖ Support | ‚úÖ | ‚úÖ | ‚ùå |

---

## üöÄ CRONOGRAMA

### Sprint 1 (Semanas 1-2): √âpica 1 - Sistema de Agentes
- **D√≠a 1-2:** Dise√±o (UI Designer)
- **D√≠a 3-7:** Backend (Backend Developer)
- **D√≠a 8-10:** Frontend (Frontend Developer)
- **D√≠a 11-12:** Testing QA
- **D√≠a 13-14:** UAT y Deploy

### Sprint 2 (Semanas 3-4): √âpica 2 - Notificaciones
- **D√≠a 1-2:** Dise√±o (UI Designer)
- **D√≠a 3-7:** Backend + DevOps (Firebase)
- **D√≠a 8-10:** Frontend Web + Mobile
- **D√≠a 11-12:** Testing QA
- **D√≠a 13-14:** UAT y Deploy

### Sprint 3 (Semanas 5-6): √âpicas 3-4
- Carga Masiva + Auditor√≠a

### Sprint 4 (Semanas 7-8): √âpicas 5-9
- Deadlines + Facturaci√≥n + Estado + Papelera + Mayor de Edad

---

**Documento creado:** 16 de Octubre, 2025  
**Responsable:** Project Manager  
**Pr√≥xima revisi√≥n:** Semanal durante ejecuci√≥n
